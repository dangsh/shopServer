{% extends "base.html" %}

{% block css %}
    <style type="text/css">
        .form-inline{
			font-family: "黑体";
			height: 20px;
			text-align: center;
		}
		.trash , .delete{
			background-color: #D33A3C;
		}
		.plus{
			background-color: #00c0ef;
            border-color: #00acd6;
        }
		
		.submit , .edit{
			background-color: #4FAF4C;
		}
		th{
			background-color: #F2F9FE;
		}
		#userTable .nature{
			background-color: #F2F9FE;
		}
		#userTable .ele{
			background-color: white;
		}
		.table{
			width: 100%;
		}
		.count{
			font:"黑体"
		}
		.btn{
			color: black;
		}
		.btn-default{
			color: white;
		}
		#under .bottom{
			background-color: white;
			border:1px solid lightgrey;
		}

    </style>
{% endblock %}

{% block content %}
    <div class="container-fluid">
        <form class="form-inline" role="form">
            <div class="form-group">
                <label class="" >用户名:</label>
                <input type="text" class="form-control" id="exampleUsername" placeholder="请输入用户名">
            </div>
            <div class="form-group">
                <label class="" >手机号:</label>
                <input type="password" class="form-control" id="exampleInputPhoneNumber" placeholder="请输入手机号">
            </div>
            <button type="submit" class="btn btn-default submit"><span class = "glyphicon glyphicon-search">查询会员</span></button>
        </form>
        <hr/>
	
            
        <table  class="table table-bordered">
            <th colspan="11">
                
                    <button class="btn btn-default trash"><span class = "glyphicon glyphicon-trash">批量删除</span></button>
                    <button class="btn btn-default plus btn btn-primary" data-toggle="modal" data-target="#plusModal" ><span class = "glyphicon glyphicon-plus">添加会员</span></button>
                    <label id="userNumber" class="count" style="float: right; padding-right: 4%;">共有数据</label>
                
            </th>
            <tr>
                <td class="info nature"><input type="checkbox" id = "checkbox-all"></td>
                <td class="info nature">序号</td>
                <td class="info nature">会员名</td>
                <td class="info nature">密码</td>
                <td class="info nature">电话</td>
                <td class="info nature">微信</td>
                <td class="info nature">头像</td>
                <td class="info nature">账户余额</td>
                <td class="info nature">等级</td>
                <td class="info nature">激活码</td>
                <td class="info nature">编辑</td>
            </tr>
            
            <tbody id="userTable">

            </tbody>
                   
        </table>
        <div class="row" id="div3" style=" padding: 1% 0;">
            <div class="col-md-12" style="text-align: left;">
                    
                    <div class="text-center">
                        <ul id="visible-pages-example"></ul>
                    </div>
            </div>
        </div>
        


        <div id="plusModal" class="modal fade" tabindex="-1" role="dialog" data-backdrop="false" data-show="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">添加会员</h4>
					</div>
					<div class="modal-body">
						<form class="addform" action="http://localhost:8000/userManageJsonAdd/" method="post">
                            <div class="form-group">
                            <label for="recipient-name" class="control-label">用户昵称:</label>
                            <input type="text" class="form-control" name="username">
                            </div>
                            <div class="form-group">
                            <label for="recipient-name" class="control-label">用户密码:</label>
                            <input type="text" class="form-control" name="pwd">
                            </div>
                            <input type="submit" class="btn btn-primary" value="添加">
                        </form>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
        </div>


        
        <!-- Small modal -->
        
        <div class="myModal">
           
        </div>
        

{% endblock %}



{% block script %}
<!-- <script>
$(".addform").on('submit', function(e){
    aaa=$(".tijiao")
    console.log(aaa);
    e.preventDefault();
    // success:function(aaa){
    //     console.log("111111111");
    // }
});
</script> -->
    

    <script type="text/javascript">
    $('.addform').on('submit', function(e) {
        console.log("jjjjjj");
        e.preventDefault(); 
        $(this).ajaxSubmit({
            success: function (result) {
                console.log(result);
                window.location.reload();
                parent.$("#plusModal").hide();
            }
        })
    });

    

        var url="http://localhost:8000/userManageJsonSelect/";
        $.ajax({
			        url: url, 
					type: 'POST', 
					success:"success",
			        success: function (result) {
                        dataParse(result);            
			        }, 
			        error: function (msg) {
			        	console.log(msg); //错误信息
                    }    
                });
        function dataParse(data){
            for(i=0 ; i<data.data.length ; i++){
                mydata =  data.data[i]
                var userid = mydata["userid"];
                var username = mydata["username"];
                var pwd = mydata["pwd"];
                var phone = mydata["phone"];
                var wxid = mydata["wxid"];
                var headimg = mydata["headimg"];
                var acountmoney = mydata["acountmoney"];
                var power = mydata["power"];
                var activecode = mydata["activecode"];
                var ele = '<tr userid = "' + userid + '" username = "' + username + '" pwd = "' + pwd + '" phone = "' + phone + '" wxid = "' + wxid + '" heading = "' + headimg + '" acountmoney = "' + acountmoney + '" headimg="' + headimg +'"  power = "' + power + '" activecode = "' + activecode + '"><td class="info ele"><input class="checkbox-one" type="checkbox"/></td><td class="info ele">' + userid + '</td><td class="info ele">' + username + '</td><td class="info ele">' + pwd + '</td><td class="info ele">' + phone + '</td><td class="info ele">' + wxid + '</td><td class="info ele">' + headimg + '</td><td class="info ele">' + acountmoney + '</td><td class="info ele">' + power + '</td><td class="info ele">' + activecode + '</td><td class="info ele"><button class="btn btn-default edit btn-primary" data-toggle="modal" data-target="#editModal' + userid + '">编辑</button>     <button class="btn btn-default delete">删除</button></td></tr>'
                $(".myModal").empty();
                $("#userTable").append(ele);
             
            }
            $(".delete").click(function(){
                var that = $(this).parents('tr');
                var objData = that.attr('userid')
                var url = "http://localhost:8000/userManageJsonDelete/";
                console.log(objData)
                ajaxFn(url , objData , function(){
                    $(that).remove();
                })
            })
            $(".edit").click(function(){
                // console.log("jklajskldf");

                var that = $(this).parents("tr");
                console.log(that)
                var userid = that.attr('userid');
                aaa = userid;
                var username = that.attr('username');
                var pwd = that.attr('pwd');
                var phone = that.attr('phone');
                var wxid = that.attr('wxid');
                var headimg = that.attr('headimg');
                var acountmoney = that.attr('acountmoney');
                var power = that.attr('power');
                var activecode = that.attr('activecode');
                console.log(username);
                var ele = '<div class="modal fade bs-example-modal-sm theEditModal" id="editModal' + userid + '" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">修改会员资料</h4></div><div class="modal-header" id="updetaModal"><form class="editFormContent" action="http://localhost:8000/userManageJsonUpdate/" method="post"><div class="form-group"><label for="recipient-name" class="control-label">序号：</label><input type="text" class="form-control" name="userid" value="' + userid + '" readonly="readonly"></div><div class="form-group"><label for="recipient-name" class="control-label">会员名:</label><input type="text" class="form-control" name="username" value="' + username + '"></div><div class="form-group"><label for="recipient-name" class="control-label">密码:</label><input type="text" class="form-control" name="pwd" value="' + pwd + '"></div><div class="form-group"><label for="recipient-name" class="control-label">电话:</label><input type="text" class="form-control" name="phone" value="' + phone + '"></div><div class="form-group"><label for="recipient-name" class="control-label">微信:</label><input type="text" class="form-control" name="wxid" value="' + wxid + '"></div><div class="form-group"><label for="recipient-name" class="control-label">头像:</label><input type="text" class="form-control" name="headimg" value="' + headimg + '"></div><div class="form-group"><label for="recipient-name" class="control-label">账户余额:</label><input type="text" class="form-control" name="acountmoney" value="' + acountmoney + '"></div><div class="form-group"><label for="recipient-name" class="control-label">等级:</label><input type="text" class="form-control" name="power" value="' + power + '"></div><div class="form-group"><label for="recipient-name" class="control-label">激活码:</label><input type="text" class="form-control" name="activecode" value="' + activecode +'"></div><input type="submit" class="btn btn-primary" value="更新"></form></div></form></div></div></div></div>'
                $(".myModal").empty();
                
                $(".myModal").append(ele)

                $(".editFormContent").eq(0).on("submit" , function(e){
                    console.log("jkajskdjkflkd");
                    e.preventDefault();
                    $(this).ajaxSubmit({
                        success:function(result){
                            console.log('post数据成功')
                            window.location.reload();
                            parent.$(".theEditModal").hide();
                            $(".editFormContent").on("submit" , "")
                        }
                    })
                })
            })
            $("#userNumber").text("共有数据" + data.data.length + "条");
        }
        


        $('#checkbox-all').click(function () {
            if($('#checkbox-all').is(':checked')) {
                console.log("get - all")
                $(".checkbox-one").prop("checked",true);
            }else{
                console.log("close - all")
                $(".checkbox-one").prop("checked",false);
            }
        })
        $('#visible-pages-example').twbsPagination({
            totalPages:35,
            first: "首页",
            last: "尾页",
            prev: '上一页',
            next: '下一页',
            startPage: 1,
            visiblePages: 5,
            version: '1.1',
            onPageClick: function (event, page) {   
            }
        });

        function ajaxFn(urlString , postdata , fn){
            var xmlhttp=new XMLHttpRequest();
            xmlhttp.onreadystatechange=function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    result = xmlhttp.responseText;
                    console.log(result)
                    fn(result);
                }
            }
            xmlhttp.open("POST",urlString,true);
            xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
            xmlhttp.send("data = " + postdata);
        }       
        
    </script>

{% endblock %}


